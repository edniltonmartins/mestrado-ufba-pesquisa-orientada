<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:p="http://xmlns.jcp.org/jsf/passthrough">
	
	<f:metadata>
		<f:viewParam id="projectId" name="projectId" value="#{reviewListMB.project.id}" required="#{not facesContext.postback}"  requiredMessage="#{messages['project.detail.error.projectId']}"  />
		<f:event listener="#{reviewListMB.initList}" type="preRenderView"/>
	</f:metadata>
	
	
	<h:body>
		<ui:composition template="layout/mainLayout.xhtml">
			<ui:define name="titlePage">Detalhes do Projeto</ui:define>
			
			<ui:define name="content">
				<f:loadBundle var="reviewsMsg" basename="br.ufba.dcc.mestrado.computacao.reviews"   />
				
				<section class="container">
				
					<h:form prependId="false" >	
					
						<h:panelGroup id="alert" layout="block" styleClass="alert alert-danger col-md-12" rendered="#{reviewListMB.project.id eq null}">
							<strong>Vish! </strong>
							<h:messages  />
						</h:panelGroup>
					
										
						<div class="row">
						
							<h:panelGroup id="reviewsPanel" layout="block">
								
								<h:panelGroup layout="block" id="breadcrump" rendered="#{reviewListMB.dataModel.rowAvailable}">
									<!-- Exibindo quantidade de resultados -->
									<ul class="breadcrumb" style="border-bottom: 1px solid #ddd;">
										<li>
											Exibindo página <h:outputText value="#{reviewListMB.pageList.currentPage}" /> de <h:outputText value="#{reviewListMB.pageList.totalPages}" /> 
										</li>
									</ul>
								</h:panelGroup>							

								<h:panelGroup layout="block" id="reviews">
									<section>
										<ul class="media-list">
											<ui:repeat var="preference" value="#{reviewListMB.dataModel}" varStatus="status"  >
												<li class="media well">
													<h:outputLink styleClass="pull-left" >
														<div>
															... <h:outputText value="#{preference.user.login}" /> disse:
														</div>
														<h:graphicImage styleClass="media-object pull-right img-thumbnail" height="64" width="64" library="default" name="img/no_logo.png" />													
													</h:outputLink>
													
													<div class="media-body pul-right" style="padding-left: 10px">
														<div>
															<div class="pull-left">
			      												<h4 class="media-heading strong">
			      													<h:outputText value="#{preference.preferenceReview.title}" />      													
			      												</h4>
															</div>
															<div class="pull-left" style="margin-left: 20px">
			      												<div class="rateit" data-rateit-readonly="true"
																		data-rateit-min="0" data-rateit-max="10"
																		data-rateit-value="#{preference.value}" data-rateit-ispreset="true"  />
															</div>
														</div>
	      												
	      												<div  style="clear: both; color: #777; font-style: italic; font-family: Georgia,'Times New Roman',Times,serif;">
	      													<abbr class="small soft" title="#{preference.registeredAt}">
		      													<h:outputText value="#{preference.registeredAt}">
		      														<f:convertDateTime pattern="'escrito no dia' dd/MM/yyyy 'às' HH:mm:ss" />
		      													</h:outputText>
		      												</abbr>
	      												</div>
	      												
	      												<h:panelGroup layout="block" style="clear: both; margin-top: 20px"
	      														rendered="#{not empty preference.preferenceEntryList}">
															<table class="table table-condensed unstyled pull-left" style="width: 75%" >
																<tbody >
			      													<ui:repeat var="preferenceEntry" value="#{preference.preferenceEntryList}">
			      														<tr class="pull-left" style="width: 50%;">
			      															<td style="border: none">
																				<span
																					class="glyphicon glyphicon-question-sign meuPopover"
																					data-toggle="popover" title="" data-placement="top"
																					data-content="#{preferenceEntry.criterium.description}"
																					data-original-title="#{preferenceEntry.criterium.name}">
																				</span> 
																				<h:outputText  value=" #{preferenceEntry.criterium.name}"  />
																			</td>
																			<td style="border: none">
																				<div class="rateit" data-rateit-readonly="true"
																					data-rateit-min="0" data-rateit-max="10"
																					data-rateit-value="#{preferenceEntry.value}" data-rateit-ispreset="true"  />
																			</td>
			      														</tr>
			      													</ui:repeat>
																</tbody>
															</table>
															<SCRIPT type="text/javascript">
																$('.meuPopover').popover({
				
																});
															</SCRIPT>
	      												</h:panelGroup>
	      												
	      												
	      												<div style="clear: both; padding-top: 10px">
		      												<h:outputText value="#{preference.preferenceReview.description}" />
	      												</div>
	      												<p class="soft small">
	      												</p>
	      												<div class="col-md-8 pull-left">
	      													<h:panelGroup layout="block" styleClass="small soft" 
	      															rendered="#{ (not empty preference.preferenceReview.usefulList) or (not empty preference.preferenceReview.uselessList)}">
		      													<c:set var="totalVotes" value="#{fn:length(preference.preferenceReview.usefulList) + fn:length(preference.preferenceReview.uselessList)}" />
		      													<h:outputText  value="#{fn:length(preference.preferenceReview.usefulList)}" /> 
		      													de <h:outputText value="#{totalVotes}" /> avaliaram esta opinião como útil.
	      													</h:panelGroup>
	      												</div>	      												
	      												<div class="col-md-4 pull-right">
	      													<h:panelGroup rendered="#{loginMB.loggedUser != null}">
		      													<span class="soft small italic">
			      													Você achou esta avaliação útil?
			      													
			      													<h:commandLink style="text-decoration: none; margin-left: 10px" >
			      														<f:attribute name="preference" value="#{preference}"  />
			      														<f:ajax execute="@all" render="@form" listener="#{reviewListMB.addUsefulVoteToReview}" />
				      													<span class="glyphicon glyphicon-thumbs-up" /> Sim
			      													</h:commandLink>
			      													<h:commandLink style="text-decoration: none; margin-left: 10px" >
			      														<f:attribute name="preference" value="#{preference}" />
			      														<f:ajax execute="@all" render="@form" listener="#{reviewListMB.addUselessVoteToReview}"  />
				      													<span class="glyphicon glyphicon-thumbs-down" /> Não
			      													</h:commandLink>
		      													</span>
	      													</h:panelGroup>
	      												</div>
	      											</div>				
												</li>
											</ui:repeat>
										</ul>
									</section>
									
									<script type="text/javascript">
    									$(function () { $('.rateit').rateit({ max: 10,  min: 0}); });
									</script>
								</h:panelGroup>
								
								<!-- Paginação -->
								<h:panelGroup
									rendered="#{reviewListMB.pageList.totalPages > 1}"
									id="pagination" layout="block" styleClass="pagination-center" >
									<ul class="pagination">
										<li class="#{reviewListMB.pageList.currentPage eq reviewListMB.pageList.firstPage ? 'disabled' : ''}">
											<h:commandLink actionListener="#{reviewListMB.searchReviews}" disabled="#{reviewListMB.pageList.currentPage eq reviewListMB.pageList.firstPage}" >
												<f:param  name="page" value="#{reviewListMB.pageList.firstPage}" />
												«
											</h:commandLink>
										</li>
										
										<li class="#{reviewListMB.pageList.currentPage eq reviewListMB.pageList.previousPage ? 'disabled' : ''}">
											<h:commandLink actionListener="#{reviewListMB.searchReviews}" disabled="#{reviewListMB.pageList.currentPage eq reviewListMB.pageList.previousPage}" >
												<f:param  name="page" value="#{reviewListMB.pageList.previousPage}" />
												anterior
											</h:commandLink>
										</li>
										
										<ui:repeat var="page" value="#{reviewListMB.pageList.pageList}">
											<li class="#{reviewListMB.pageList.currentPage eq page ? 'active' : ''}">
												<h:commandLink actionListener="#{reviewListMB.searchReviews}" disabled="#{reviewListMB.pageList.currentPage eq page}" >
													<f:param  name="page" value="#{page}" />
													<h:outputText value="#{page}" />
												</h:commandLink>
											</li>
										</ui:repeat>
										
										<li class="#{reviewListMB.pageList.currentPage eq reviewListMB.pageList.nextPage ? 'disabled' : ''}">
											<h:commandLink actionListener="#{reviewListMB.searchReviews}" disabled="#{reviewListMB.pageList.currentPage eq reviewListMB.pageList.nextPage}" >
												<f:param  name="page" value="#{reviewListMB.pageList.nextPage}" />
												próximo
											</h:commandLink>
										</li>
										
										
										<li class="#{reviewListMB.pageList.currentPage eq reviewListMB.pageList.lastPage ? 'disabled' : ''}">
											<h:commandLink actionListener="#{reviewListMB.searchReviews}" disabled="#{reviewListMB.pageList.currentPage eq reviewListMB.pageList.lastPage}" >
												<f:param  name="page" value="#{reviewListMB.pageList.lastPage}" />
												»
											</h:commandLink>
										</li>
									</ul>
								</h:panelGroup>
							
							</h:panelGroup>
						</div>
					</h:form>
				
				</section>
			</ui:define>
			
		</ui:composition>
	</h:body>
</html>