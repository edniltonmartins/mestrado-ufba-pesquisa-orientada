<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"	
	xmlns:p="http://xmlns.jcp.org/jsf/passthrough">
	
	<f:metadata>
		<f:viewParam id="query" name="query" value="#{mainMB.searchRequest.query}"  />
		<f:event listener="#{mainMB.init}" type="preRenderView"  />
	</f:metadata>

	<h:body>
		<ui:composition template="layout/mainLayout.xhtml">
			
			<ui:define name="titlePage">Resultado da Busca</ui:define>
			
			<ui:define name="header">
				<ui:include src="layout/mainHeader.xhtml" />
				<ui:include src="layout/selectedProjectsToCompare.xhtml" />
			</ui:define>
			
			<ui:define name="content">
				<section class="container">					
					<h:form id="searchResults">						
						<div class="row">
							
							<!-- barra lateral de tags -->
							<h:panelGroup id="tagSideBar" layout="block" styleClass="col-md-3 tag-tooltip pull-left" rendered="#{mainMB.pageList.totalPages != 0}" >
								<h4>Tags Selecionadas</h4>
								<ul class="nav nav-pills nav-stacked">
									<ui:repeat var="selectedFacet" value="#{mainMB.searchRequest.selectedFacets}">
										<li class="active">
											<h:commandLink
												actionListener="#{mainMB.removeFacetsFromFilter}"
												p:data-toggle="tooltip" 
												p:data-placement="right" 
												p:data-original-title="parar de filtar por #{selectedFacet.value}">
												
												<f:param  name="facetValue" value="#{selectedFacet.value}" />
												<i class="glyphicon glyphicon-minus-sign"></i>
												<h:outputText value=" #{selectedFacet.value}" />
												<span class="badge"><h:outputText value="#{selectedFacet.count}" /> </span>
												
											</h:commandLink>												
										</li>
									</ui:repeat>
								</ul>
								
								
								<h4>Tags Relacionadas</h4>
								<ul class="nav nav-pills nav-stacked">
									<ui:repeat var="unselectedFacet" value="#{mainMB.searchRequest.deselectedFacets}">
										<li>
											<h:commandLink
												actionListener="#{mainMB.addFacetsToFilter}"
												p:data-toggle="tooltip" 
												p:data-placement="right" 
												p:data-original-title="filtar por #{unselectedFacet.value}">
												
												<f:param  name="facetValue" value="#{unselectedFacet.value}" />
												<i class="glyphicon glyphicon-plus-sign"></i>
												<h:outputText value=" #{unselectedFacet.value}" />
												<span class="badge"><h:outputText value="#{unselectedFacet.count}" /> </span>
											</h:commandLink>
										</li>
									</ui:repeat>
								</ul>
							</h:panelGroup>
							
							<h:panelGroup id="searchResult" layout="block" styleClass="col-md-9 pull-right">
								
								<h:panelGroup layout="block" id="breadcrump" rendered="#{mainMB.dataModel.rowAvailable}">
									<!-- Exibindo quantidade de resultados -->
									<ul class="breadcrumb" style="border-bottom: 1px solid #ddd;">
										<li>
											Exibindo página <h:outputText value="#{mainMB.pageList.currentPage}" /> de <h:outputText value="#{mainMB.pageList.totalPages}" /> 
										</li>
									</ul>
								</h:panelGroup>
							
								<h:panelGroup rendered="#{mainMB.pageList.totalPages != 0}">
									<section>
										<ui:repeat var="project" value="#{mainMB.dataModel}">
											<div class="well" >
												<div class="row" style="margin: -20px -20px 0 0 ">
													<h:link outcome="projectDetail" class="pull-left">
														<f:param name="projectId" value="#{project.id}" />
														<h4><h:outputText value="#{project.name}"  /></h4>														
													</h:link>
													<div class="pull-right">
														<!-- comparableCheckboxStyle com erro de sintaxe no eclipse, mas funciona perfeitamente.  -->
														<ui:param name="comparableCheckboxStyle" value="#{mainMB.selectedItems[project.id] ? 'project-selected' : 'project-unselected' }" />
														<h:panelGroup layout="block" 
															styleClass="project-selectable #{comparableCheckboxStyle}" >
															<span style="margin-right: 10px">
																Compare
															</span>
															<h:selectBooleanCheckbox style="margin-top: 2px"
																	id="comparableCheckbox"
																	valueChangeListener="#{mainMB.onChangeSelectedItem}"
																	value="#{mainMB.selectedItems[project.id]}">
																<f:ajax event="click" execute="@form" render="@form :selectedEntities"  />
																<f:attribute name="projectId" value="#{project.id}" />
																<f:attribute name="currentPage" value="#{mainMB.pageList.currentPage}" />
															</h:selectBooleanCheckbox>
															
															<div style="clear: both;"></div>
														</h:panelGroup>
													</div>
												</div>
												<div class="media">
													<h:outputLink styleClass="pull-left" rendered="#{project.mediumLogoURL != 'no_logo.png'}">													
														<img class="media-object" src="#{project.mediumLogoURL}" height="64px" width="64px" />
													</h:outputLink>
													<h:outputLink styleClass="pull-left" rendered="#{project.mediumLogoURL eq 'no_logo.png'}">
														<h:graphicImage styleClass="media-object" height="64" width="64" library="default" name="img/#{project.mediumLogoURL}" />													
													</h:outputLink>
													<div class="media-body" style="min-height: 64px">
														<div class="expandable">
															<p>
																<h:outputText value="#{project.description}" />
															</p>
														</div>
													</div>
													<h:panelGroup layout="block" id="tagsPanel" rendered="#{not empty project.ohLohTags}" style="margin-top: 10px">
														<span class="glyphicon glyphicon-tags" style="margin-right: 5px"></span>
														<ui:repeat var="tag" value="#{project.ohLohTags}">
															<span class="label label-tag"><h:outputText value="#{tag.name}" /></span>      														
														</ui:repeat>      														
													</h:panelGroup>
												</div>
											</div>
										</ui:repeat>
									</section>
								</h:panelGroup>
								
								<h:panelGroup rendered="#{mainMB.pageList.totalPages eq 0}">
									<section>
										<ul class="media-list">
											<li class="media">
												<h4>Sua busca por <strong><h:outputText value="#{mainMB.searchRequest.query}" /></strong> não trouxe resultados.</h4>
												<p>Sugestões:</p>
												<ul>
													<li>Tenha certeza de que as palavras que você digitou estão escritas corretamente</li>
													<li>Tente palavras chave diferentes</li>
													<li>Tente palavras chave mais gerais</li>
													<li>Tente uma quantidade menor de palavras</li>
												</ul>
											</li>
										</ul>
									</section>
								</h:panelGroup>
								
								<!-- Paginação -->
								<h:panelGroup
									rendered="#{mainMB.pageList.totalPages > 1}"
									id="pagination" layout="block" styleClass="pagination-center" >
									<ul class="pagination">
										<li class="#{mainMB.pageList.currentPage eq mainMB.pageList.firstPage ? 'disabled' : ''}">
											<h:commandLink actionListener="#{mainMB.searchProjects}" disabled="#{mainMB.pageList.currentPage eq mainMB.pageList.firstPage}" >
												<f:param  name="page" value="#{mainMB.pageList.firstPage}" />
												<f:ajax render="@form :selectedEntities" />
												«
											</h:commandLink>
										</li>
										
										<li class="#{mainMB.pageList.currentPage eq mainMB.pageList.previousPage ? 'disabled' : ''}">
											<h:commandLink actionListener="#{mainMB.searchProjects}" disabled="#{mainMB.pageList.currentPage eq mainMB.pageList.previousPage}" >
												<f:param  name="page" value="#{mainMB.pageList.previousPage}" />
												<f:ajax render="@form :selectedEntities" />
												anterior
											</h:commandLink>
										</li>
										
										<ui:repeat var="page" value="#{mainMB.pageList.pageList}">
											<li class="#{mainMB.pageList.currentPage eq page ? 'active' : ''}">
												<h:commandLink actionListener="#{mainMB.searchProjects}" disabled="#{mainMB.pageList.currentPage eq page}" >
													<f:param  name="page" value="#{page}" />
													<f:ajax render="@form :selectedEntities" />
													<h:outputText value="#{page}" />
												</h:commandLink>
											</li>
										</ui:repeat>
										
										<li class="#{mainMB.pageList.currentPage eq mainMB.pageList.nextPage ? 'disabled' : ''}">
											<h:commandLink actionListener="#{mainMB.searchProjects}" disabled="#{mainMB.pageList.currentPage eq mainMB.pageList.nextPage}" >
												<f:param  name="page" value="#{mainMB.pageList.nextPage}" />
												<f:ajax render="@form :selectedEntities" />
												próximo
											</h:commandLink>
										</li>
										
										
										<li class="#{mainMB.pageList.currentPage eq mainMB.pageList.lastPage ? 'disabled' : ''}">
											<h:commandLink actionListener="#{mainMB.searchProjects}" disabled="#{mainMB.pageList.currentPage eq mainMB.pageList.lastPage}"  >
												<f:param  name="page" value="#{mainMB.pageList.lastPage}" />
												<f:ajax render="@form :selectedEntities" />
												»
											</h:commandLink>
										</li>
									</ul>
								</h:panelGroup>
								
							</h:panelGroup>
													
						</div>
						<!-- leia mais para a descricao do projeto -->
						<script>
							$('div.expandable p').expander({
								slicePoint: 300,
								expandText: '[Leia mais]',
								userCollapseText: '[Esconder]'
							});
						</script>
						
					</h:form>
				</section>
				
				<!-- tooltip das tags -->
				<script>
					$('.tag-tooltip').tooltip({
						selector: "a[data-toggle=tooltip]"
					})
				</script>
				
			</ui:define>
		</ui:composition>
	</h:body>
</html>