<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html>
<ui:composition  
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
	>
	
	<h:panelGroup layout="block" styleClass="media" rendered="#{preference != null}"> 
		
		<h:outputLink styleClass="pull-left" >
			<!-- Nome do usuário -->
			<div>
				<h:outputLink value="#{facesContext.externalContext.applicationContextPath}/account/account.jsf?accountId=#{preference.user.id}">
					<h:outputText
						rendered="#{preference.user.firstName != null and preference.user.login == null}"
						style="margin-left: 10px; vertical-align: middle" 
						value="...#{preference.user.firstName}" />
						
					<h:outputText
						rendered="#{preference.user.firstName == null and preference.user.login != null}"
						style="margin-left: 10px; vertical-align: middle" 
						value="...#{preference.user.login}" />
				</h:outputLink>
				disse:
			</div>
			<!-- Foto do usuário -->
			<h:graphicImage styleClass="media-object pull-right img-thumbnail" height="64" width="64" library="default" name="img/no_logo.png" />													
		</h:outputLink>
		
		<div class="media-body pul-right" style="padding-left: 10px">
			<div>
				<div class="pull-left">
					<h4 class="media-heading strong">
						<h:outputText value="#{preference.preferenceReview.title}" />      													
					</h4>
				</div>
				<div class="pull-left" style="margin-left: 20px">
										<div class="rateit" data-rateit-readonly="true"
							data-rateit-min="0" data-rateit-max="10"
							data-rateit-value="#{preference.value}" data-rateit-ispreset="true"  />
				</div>
			</div>
								
			<div  style="clear: both; color: #777; font-style: italic; font-family: Georgia,'Times New Roman',Times,serif;">
				<abbr class="small soft" title="#{preference.registeredAt}">
					<h:outputText value="#{preference.registeredAt}">
						<f:convertDateTime pattern="'escrito no dia' dd/MM/yyyy 'às' HH:mm:ss" />
					</h:outputText>
				</abbr>
			</div>
								
			<h:panelGroup layout="block" style="clear: both; margin-top: 20px"
					rendered="#{not empty preference.preferenceEntryList}">
				<table class="table table-condensed unstyled pull-left" >
					<tbody >
						<ui:repeat var="preferenceEntry" value="#{preference.preferenceEntryList}">
							<tr class="pull-left">
								<td style="border: none">
									<span
										class="glyphicon glyphicon-question-sign meuPopover"
										data-toggle="popover" title="" data-placement="top"
										data-content="#{preferenceEntry.criterium.description}"
										data-original-title="#{preferenceEntry.criterium.name}">
									</span> 
									<h:outputText  value=" #{preferenceEntry.criterium.name}"  />
								
									<h:panelGroup style="margin-left: 10px" styleClass="soft small" rendered="#{entry.value != null and entry.value > 0}">
										(<h:outputText value="#{entry.value}" >
											<f:convertNumber maxFractionDigits="2" maxIntegerDigits="2" pattern="#0.00" />
										</h:outputText> / 10)
									</h:panelGroup>
									<h:panelGroup style="margin-left: 10px" styleClass="soft small" rendered="#{entry.value == null or entry.value == 0}">
										(0 / 10)
									</h:panelGroup>
									
									<br />								

									<div class="rateit" data-rateit-readonly="true"
										data-rateit-min="0" data-rateit-max="10"
										data-rateit-value="#{preferenceEntry.value}" data-rateit-ispreset="true"  />
								</td>
							</tr>
						</ui:repeat>
					</tbody>
				</table>
				<SCRIPT type="text/javascript">
					$('.meuPopover').popover({

					});
				</SCRIPT>
			</h:panelGroup>
								
			<div style="clear: both; padding-top: 10px">
				<h:outputText value="#{preference.preferenceReview.description}" />
			</div>
			
			<p class="soft small">
			</p>
			
		</div>
		<div class="row">
			<div class="col-md-6 pull-left">
				<ui:param name="totalVotes" value="#{preference.preferenceReview.usefulCount + preference.preferenceReview.uselessCount}" />
				<h:panelGroup layout="block" styleClass="small soft" rendered="#{totalVotes > 0}">
					<h:outputText  value="#{fn:length(preference.preferenceReview.usefulList)}" /> 
					de <h:outputText value="#{totalVotes}" /> avaliaram esta opinião como útil.
				</h:panelGroup>
			</div>	      				
			<h:panelGroup layout="block" styleClass="col-md-6 pull-right" rendered="#{enableVoting}">
				<h:panelGroup rendered="#{loginMB.loggedUser != null}">
					<span class="soft small italic">
						Você achou esta avaliação útil?
						<br />
						<h:commandLink style="text-decoration: none; margin-right: 10px" >
							<f:attribute name="preference" value="#{preference}"  />
							<f:ajax execute="@all" render="@form" listener="#{bean.addUsefulVoteToReview}" />
							<span class="glyphicon glyphicon-thumbs-up" /> Sim
						</h:commandLink>
						<h:commandLink style="text-decoration: none; margin-right: 10px" >
							<f:attribute name="preference" value="#{preference}" />
							<f:ajax execute="@all" render="@form" listener="#{bean.addUselessVoteToReview}"  />
							<span class="glyphicon glyphicon-thumbs-down" /> Não
						</h:commandLink>
					</span>
				</h:panelGroup>
			</h:panelGroup>								
		</div>
	</h:panelGroup>
	
</ui:composition>