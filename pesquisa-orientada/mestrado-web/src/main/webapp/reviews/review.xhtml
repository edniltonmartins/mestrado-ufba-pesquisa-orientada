<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html>
<ui:composition  
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
	>
	
	
	<h:panelGroup layout="block" styleClass="row" rendered="#{preference != null}">
		<!-- Dados do usuario ou projeto -->
		
		<h:panelGroup layout="block" styleClass="pull-left" rendered="#{hidingProject}" style="width: 13%">
			<div class="pull-right" style="text-align: right;">
				<h:outputLink value="#{facesContext.externalContext.applicationContextPath}/account/account.jsf?accountId=#{preference.user.id}">
					<h:outputText
						rendered="#{preference.user.firstName != null and preference.user.login == null}"
						style="margin-left: 10px; vertical-align: middle" 
						value="...#{preference.user.firstName}" />
					<h:outputText
						rendered="#{preference.user.firstName != null and preference.user.login != null}"
						style="margin-left: 10px; vertical-align: middle" 
						value="...#{preference.user.firstName}" />
					<h:outputText
						rendered="#{preference.user.firstName == null and preference.user.login != null}"
						style="margin-left: 10px; vertical-align: middle" 
						value="...#{preference.user.login}" />
				</h:outputLink>
				disse:
			</div>
			
			<br />
			<!-- Foto do usuario -->
			<h:panelGroup layout="block" rendered="#{ (preference.user.encodedEmail eq null) or (preference.user.encodedEmail eq '') }">
				<h:graphicImage styleClass="media-object pull-right img-thumbnail" height="64" width="64" library="default" name="img/no_logo.png" />
			</h:panelGroup>
			<h:panelGroup layout="block" rendered="#{ (preference.user.encodedEmail != null) and (preference.user.encodedEmail != '') }">
				<h:graphicImage styleClass="media-object pull-right img-thumbnail" url="http://www.gravatar.com/avatar/#{preference.user.encodedEmail}.png?s=128&amp;d=mm" />
			</h:panelGroup>
		</h:panelGroup>
		
		<h:panelGroup styleClass="pull-left" rendered="#{hidingUser}" style="width: 13%">
			<div style="margin-left: 15px" class="row">
				<h:outputLink styleClass="pull-left" rendered="#{preference.project.mediumLogoURL != 'no_logo.png'}">													
					<img class="media-object" src="#{preference.project.mediumLogoURL}" height="64px" width="64px" />
				</h:outputLink>
				<h:outputLink styleClass="pull-left" rendered="#{preference.project.mediumLogoURL eq 'no_logo.png'}">
					<h:graphicImage styleClass="media-object" height="64" width="64" library="default" name="img/#{preference.project.mediumLogoURL}" />													
				</h:outputLink>
			</div>
			<div style="margin-left: 15px" class="row">
				<h:outputLink value="#{facesContext.externalContext.applicationContextPath}/detail/projectDetail.jsf" class="pull-left">
					<f:param name="projectId" value="#{preference.project.id}" />
					<h4><h:outputText value="#{preference.project.name}" style="font-size: 14px" /></h4>														
				</h:outputLink>
			</div>
			
		</h:panelGroup>
		
		<div style="width: 5%"></div>
		
		<div class="pull-right" style="width: 82%">
			<div class="row">
				<!-- Titulo da Review -->
				<div class="pull-left">
					<h4 class="media-heading strong">
						<h:outputText value="#{preference.preferenceReview.title}" />      													
					</h4>
				</div>
				<!-- Nota da review -->
				<div class="pull-left" style="margin-left: 10px">				
					<!-- Estrelas -->
					<div class="rateit" data-rateit-readonly="true"
							data-rateit-min="0" data-rateit-max="10"
							data-rateit-value="#{preference.value}" data-rateit-ispreset="true"  />
							
					<!-- legenda das estrelas -->
					<h:panelGroup style="margin-left: 10px" styleClass="soft small" rendered="#{preference.value != null and preference.value > 0}">
						(<h:outputText value="#{preference.value}" >
							<f:convertNumber maxFractionDigits="2" maxIntegerDigits="2" pattern="#0.00" />
						</h:outputText> / 10)
					</h:panelGroup>
					<h:panelGroup style="margin-left: 10px" styleClass="soft small" rendered="#{preference.value == null or preference.value == 0}">
						(0 / 10)
					</h:panelGroup>
						
				</div>
			</div>
			
			<!-- data em que foi escrita -->
			<div class="row">
				<span class="small soft italic" title="#{preference.registeredAt}">
					<h:outputText value="#{preference.registeredAt}">
						<f:convertDateTime pattern="'escrito no dia' dd/MM/yyyy 'às' HH:mm:ss" />
					</h:outputText>
				</span>
			</div>
			
			<!-- notas por critério -->
			<h:panelGroup layout="block" class="row" style="clear: both; margin-top: 20px"
					rendered="#{not empty preference.preferenceEntryList}">
					
				<ui:include src="/reviews/reviewByCriterium.xhtml">
					<ui:param name="preference" value="#{preference}" />
					<ui:param name="criteriumInPopup" value="#{criteriumInPopup}" />
					<ui:param name="reviewId" value="#{preference.id}"  />
				</ui:include>
			</h:panelGroup>
			
			<!-- descrição da review -->
			<div class="row" style="clear: both; padding-top: 10px">
				<div class="col-md-10">
					<h:outputText value="#{preference.preferenceReview.description}" />
				</div>
				<div class="col-md-2">
				</div>
			</div>
			
			<p class="soft small">
			</p>
			
			<div class="row">
				<div class="col-md-6 pull-left">
					<ui:param name="totalVotes" value="#{preference.preferenceReview.usefulCount + preference.preferenceReview.uselessCount}" />
					<h:panelGroup layout="block" styleClass="small soft" rendered="#{totalVotes > 0}">
						<h:outputText  value="#{fn:length(preference.preferenceReview.usefulList)}" /> 
						de <h:outputText value="#{totalVotes}" /> avaliaram esta opinião como útil.
					</h:panelGroup>
				</div>	      				
				<h:panelGroup layout="block" styleClass="col-md-6 pull-right" rendered="#{enableVoting}">
					<h:panelGroup rendered="#{loginMB.loggedUser != null}">
						<span class="soft small italic">
							Você achou esta avaliação útil?
							<br />
							<h:commandLink style="text-decoration: none; margin-right: 10px" >
								<f:attribute name="preference" value="#{preference}"  />
								<f:ajax execute="@all" render="@form" listener="#{bean.addUsefulVoteToReview}" />
								<span class="glyphicon glyphicon-thumbs-up" /> Sim
							</h:commandLink>
							<h:commandLink style="text-decoration: none; margin-right: 10px" >
								<f:attribute name="preference" value="#{preference}" />
								<f:ajax execute="@all" render="@form" listener="#{bean.addUselessVoteToReview}"  />
								<span class="glyphicon glyphicon-thumbs-down" /> Não
							</h:commandLink>
						</span>
					</h:panelGroup>
				</h:panelGroup>								
			</div>
		
		</div>
	</h:panelGroup>
	
	
</ui:composition>