<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://xmlns.jcp.org/jsf/passthrough">

<f:metadata>
	<f:viewParam id="projectId" name="projectId"
		value="#{newReviewMB.project.id}" required="true" requiredMessage="#{messages['project.review.error.projectId']}" />
	<f:event listener="#{newReviewMB.initNew}" type="preRenderView" />
</f:metadata>

<h:body>
	<ui:composition template="/layout/mainLayout.xhtml">

		<ui:define name="titlePage">Nova Avaliação</ui:define>

		<ui:define name="content">
			<section class="container">
				<h:panelGroup id="projectReviewError" layout="block"
					styleClass="alert alert-danger col-md-12"
					rendered="#{newReviewMB.project.id eq null}">
					<strong>Vish! </strong>
					<h:message for="projectId" />
				</h:panelGroup>
				
				

				<h:panelGroup id="projectTitle" layout="block" styleClass="row">
					<div class="col-md-1">
						<a class="pull-left" href="#"> 
							<h:outputLink styleClass="pull-left" rendered="#{newReviewMB.project.mediumLogoURL != 'no_logo.png'}">													
								<img class="media-object" src="#{newReviewMB.project.mediumLogoURL}" height="64px" width="64px" />
							</h:outputLink>
							<h:outputLink styleClass="pull-left" rendered="#{newReviewMB.project.mediumLogoURL eq 'no_logo.png'}">
								<h:graphicImage styleClass="media-object" height="64" width="64" library="default" name="img/no_logo.png" />													
							</h:outputLink>							
						</a>
					</div>
					<div class="col-md-9">
						<h2>
							<h:outputText value="#{newReviewMB.project.name}" />
						</h2>
					</div>
				</h:panelGroup>

				<h:panelGroup id="projectReview" layout="block" styleClass="row">
					<hr />
					<h3>
						<h:outputLink value="projectReviews.jsf">
							<f:param name="projectId" value="#{newReviewMB.project.id}" />
								Avaliações:
							</h:outputLink>
						Nova
					</h3>

					<div class="col-md-9" style="margin-left: 137px;">
						<div class="well">
							<h:form id="projectReviewForm">
							
								<ui:include src="/reviews/reviewCriteriumHelp.xhtml"/>

								<div class="panel panel-primary">
									<div class="panel-heading">
										<h2 class="panel-title">Critérios de Avaliação:</h2>
									</div>
									<div class="panel-body">
										<!-- TODO: 
												Lembrar de colocar um popover do bootstrap em cada título de critério de avaliação 
											-->

										<fieldset>
											<legend>Critérios Individuais</legend>
											<ui:repeat var="preferenceEntry"
												value="#{newReviewMB.preference.preferenceEntryList}"
												varStatus="status">
												<div class="col-md-6" style="height: 70px; margin-bottom: 10px">
													<div class="row">
														<div class="form-group">
															<label> 
																<span
																	class="glyphicon glyphicon-question-sign meuPopover"
																	data-toggle="popover" title="" data-placement="top"
																	data-content="#{preferenceEntry.criterium.description}"
																	data-original-title="#{preferenceEntry.criterium.name}">
																</span> 
																<h:outputText value=" #{preferenceEntry.criterium.name}" />
															</label> 
															<br />
															<h:inputText type="range"
																styleClass="criterio#{preferenceEntry.criterium.id}"
																value="#{preferenceEntry.value}" min="0" max="10" />
															<div class="rateit"
																data-rateit-backingfld=".criterio#{preferenceEntry.criterium.id}"
																data-rateit-min="0" data-rateit-max="10"></div>
														</div>
													</div>
												</div>
											</ui:repeat>
											<SCRIPT type="text/javascript">
												$('.meuPopover').popover({

												});
											</SCRIPT>
										</fieldset>

										<fieldset>
											<legend>Avaliação Geral</legend>
											<div class="col-md-12">
												<div class="row">
													<div class="form-group">
														<h:inputText type="range" styleClass="criterioGeral"
															value="#{newReviewMB.preference.value}" min="0"
															max="10" />
														<div class="rateit"
															data-rateit-backingfld=".criterioGeral"
															data-rateit-min="0" data-rateit-max="10"></div>
													</div>
												</div>
											</div>
										</fieldset>



									</div>
								</div>



								<div class="panel panel-primary">
									<div class="panel-heading">
										<h2 class="panel-title">Dê a sua opinião</h2>
									</div>
									<div class="panel-body">
										<div class="form-group">
											<h:outputLabel for="reviewTitle">Título</h:outputLabel>
											<h:inputText id="reviewTitle" styleClass="form-control"
												value="#{newReviewMB.preference.preferenceReview.title}" />
										</div>

										<div class="form-group">
											<h:outputLabel for="reviewDescription">Descrição</h:outputLabel>
											<h:inputTextarea id="reviewDescription"
												styleClass="form-control" rows="5"
												value="#{newReviewMB.preference.preferenceReview.description}" />
										</div>
									</div>
								</div>

								<h:commandButton styleClass="btn btn-primary" value="Enviar"
									action="#{newReviewMB.saveReview}">
								</h:commandButton>
							</h:form>
						</div>
					</div>
				</h:panelGroup>
			</section>
		</ui:define>

	</ui:composition>
</h:body>
</html>