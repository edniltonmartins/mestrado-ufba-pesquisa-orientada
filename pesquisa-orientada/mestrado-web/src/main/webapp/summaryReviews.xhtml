<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:p="http://xmlns.jcp.org/jsf/passthrough">
	
	<f:metadata>
		<f:viewParam id="projectId" name="projectId" value="#{summaryReviewsMB.project.id}" required="#{not facesContext.postback}"  requiredMessage="#{messages['project.detail.error.projectId']}"  />
		<f:event listener="#{summaryReviewsMB.init}" type="preRenderView"/>
	</f:metadata>
	
	<h:body>
		<ui:composition template="layout/mainLayout.xhtml">
		
			<ui:define name="titlePage">Avaliações e Opiniões</ui:define>
			
			<ui:define name="content">
			
				<section class="container">
				
					<h:panelGroup id="alert" layout="block" styleClass="alert alert-danger col-md-12" rendered="#{summaryReviewsMB.project.id eq null}">
						<strong>Vish! </strong>
						<h:message for="projectId"  />
					</h:panelGroup>
					
					<h:panelGroup id="projectTitle" layout="block" styleClass="row">
						<div class="col-md-1">
							<a class="pull-left" href="#">
								<img class="media-object" data-src="holder.js/64x64" src="#{summaryReviewsMB.project.mediumLogoURL}"  />
							</a>
						</div>
						<div class="col-md-9">
							<h2> <h:outputText value="#{summaryReviewsMB.project.name}" /> </h2>
						</div>
					</h:panelGroup>
					
					<hr />
					
					<h:panelGroup layout="block" styleClass="row">
					
						<div class="col-md-3">
							<h3>Avaliações e Opiniões</h3>
							
							<p class="soft">
								<b>Avaliação média</b>
								<div class="rateit" data-rateit-readonly="true"
									data-rateit-min="0" data-rateit-max="10"
									data-rateit-value="#{summaryReviewsMB.averagePreference.value}" data-rateit-ispreset="true"  />
								<br />
								Avaliação média: 
								<h:outputText value="#{summaryReviewsMB.averagePreference.value}" >
									<f:convertNumber maxFractionDigits="2" maxIntegerDigits="2" pattern="#0.00" />
								</h:outputText> / 10
								<br />
								Número de avaliações:
								<h:outputText 
									value="#{summaryReviewsMB.overallPreferenceCount}" />
								<br />
								Número de opiniões:
								<h:outputText 
									value="#{summaryReviewsMB.reviewsCount}" />
							</p>
						</div>
						
						<div class="col-md-9">
							<div class="well">
								<h3>Minha avaliação deste projeto:</h3>
							</div>
						</div>
					
					</h:panelGroup>
					
					<hr />
					
					<h:panelGroup layout="block" styleClass="row">
						<div class="col-md-9 col-md-offset-3">
							<h3>Avaliação média por Critério</h3>
							<table class="table table-condensed unstyled pull-left" style="width: 75%" >
								<tbody>
									<ui:repeat var="entry" value="#{summaryReviewsMB.averagePreference.preferenceEntryList}">
										<tr class="pull-left" style="width: 50%;">
											<td style="border: none">
												<span
													class="glyphicon glyphicon-question-sign meuPopover"
													data-toggle="popover" title="" data-placement="top"
													data-content="#{entry.criterium.description}"
													data-original-title="#{entry.criterium.name}">
												</span> 
												<h:outputText value=" #{entry.criterium.name}" />
											</td>
											<td style="border: none">
												<div class="rateit" data-rateit-readonly="true"
													data-rateit-min="0" data-rateit-max="10"
													data-rateit-value="#{entry.value}" data-rateit-ispreset="true"  />
											</td>
										</tr>
									</ui:repeat>
								</tbody>
							</table>
							<SCRIPT type="text/javascript">
								$('.meuPopover').popover({
	
								});
							</SCRIPT>
						</div>
					</h:panelGroup>
					
					<h:form>
						<h:panelGroup layout="block" styleClass="row" style="margin-bottom: 20px">
							<div class="col-md-6">
								<h3>
									<h:outputLink value="reviewsList.jsf">
										<f:param name="projectId" value="#{summaryReviewsMB.project.id}" />
										Opiniões mais úteis
									</h:outputLink>
								</h3>
								
								<h:outputLink value="reviewsList.jsf" styleClass="btn btn-default">
									<f:param name="projectId" value="#{summaryReviewsMB.project.id}" />
									Ver todas as opiniões
								</h:outputLink>
							</div>
							<div class="col-md-6">
								<h3>
									<h:outputLink value="reviewsList.jsf">
										<f:param name="projectId" value="#{summaryReviewsMB.project.id}" />
										Opiniões mais recentes
									</h:outputLink>
								</h3>
							</div>
						</h:panelGroup>
					</h:form>
				
				</section>
			
			</ui:define>
		
		</ui:composition>
	</h:body>
	
</html>